# Snippy Backend# Snippy Backend

REST API for code snippet management with Go, Gin, and PostgreSQL.# Snippy Backend

[![CI](https://github.com/jheysaaz/snippy-backend/actions/workflows/ci.yml/badge.svg)](https://github.com/jheysaaz/snippy-backend/actions/workflows/ci.yml)
[![Go Report Card](https://goreportcard.com/badge/github.com/jheysaaz/snippy-backend)](https://goreportcard.com/report/github.com/jheysaaz/snippy-backend)
[![codecov](https://codecov.io/gh/jheysaaz/snippy-backend/branch/main/graph/badge.svg)](https://codecov.io/gh/jheysaaz/snippy-backend)

A high-performance REST API for managing code snippets, built with Go, Gin, and PostgreSQL.

## Features

## Features## Features

- üîê Secure authentication (Argon2id password hashing)- ‚ú® Create, read, update, and delete code snippets

- üÜî UUID-based user IDs- üë§ User management with secure password authentication (Argon2id)

- üìù Full CRUD operations for snippets and users- üîê Login system with email and password

- üîç Full-text search and filtering- üÜî UUID-based user IDs (automatically generated by PostgreSQL)

- ‚ö° Optimized PostgreSQL with connection pooling- ÔøΩ Optimized PostgreSQL database with strategic indexes

- üåê CORS-enabled for browser extensions- üîç Full-text search capabilities

- üè∑Ô∏è Array-based tag system with GIN indexing

## Quick Start- üéØ Query filtering by language, tags, and search terms

- ‚ö° Connection pooling for high performance

````bash- üåê CORS enabled for Chrome extension integration

# Start PostgreSQL- üîÑ Auto-updating timestamps via database triggers

docker-compose up -d

## Prerequisites

# Run server (auto-creates schema)

go run .- Go 1.24 or higher

```- PostgreSQL 12 or higher



Server runs on `http://localhost:8080`## Setup



## API Endpoints1. Clone the repository and navigate to the project directory



### Authentication2. Start PostgreSQL with Docker:

```bash

# Register   ```bash

POST /api/v1/users   docker-compose up -d

{   ```

  "username": "john",

  "email": "john@example.com",3. Copy the example environment file:

  "password": "secure123"

}   ```bash

   cp .env.example .env

# Login   ```

POST /api/v1/auth/login

{4. Update the `.env` file with your PostgreSQL connection details (optional, defaults work with docker-compose)

  "email": "john@example.com",

  "password": "secure123"5. Install dependencies:

}

```   ```bash

   go mod download

### Users   ```

- `GET /api/v1/users` - List all users

- `GET /api/v1/users/:id` - Get user by UUID6. Run the server (it will automatically create tables and indexes):

- `GET /api/v1/users/username/:username` - Get user by username   ```bash

- `PUT /api/v1/users/:id` - Update user   go run .

- `DELETE /api/v1/users/:id` - Delete user   ```

- `GET /api/v1/users/:id/snippets` - Get user's snippets

The server will start on `http://localhost:8080` (or the port specified in your `.env` file).

### Snippets

```bash## Performance Optimizations

# Create

POST /api/v1/snippetsThe API includes several PostgreSQL-specific optimizations:

{

  "title": "Hello World",- **B-tree index** on `created_at` for fast date-based sorting

  "code": "print('Hello')",- **B-tree index** on `category` for filtering by category
- **B-tree index** on `shortcut` for quick shortcut lookups

  "language": "python",- **GIN index** on `tags` array for efficient tag lookups

  "tags": ["basics"],- **Full-text search index** on title and description using PostgreSQL's tsvector

  "userId": "uuid-here"- **Connection pooling** with configurable pool size (25 max, 5 idle)

}- **Database triggers** for automatic timestamp updates

- **Prepared statement support** via parameterized queries

# List with filters

GET /api/v1/snippets?language=python&tag=basics&search=hello## API Endpoints



# Update### Health Check

PUT /api/v1/snippets/:id

- `GET /api/v1/health` - Check if the API is running

# Delete

DELETE /api/v1/snippets/:id### Authentication

````

- `POST /api/v1/auth/login` - Login with email and password

## Database Schema

### Users

````sql

-- Users (UUID primary key, auto-generated)- `GET /api/v1/users` - Get all users

CREATE TABLE users (- `GET /api/v1/users/:id` - Get a specific user by ID

    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),- `GET /api/v1/users/username/:username` - Get a user by username

    username VARCHAR(255) UNIQUE NOT NULL,- `POST /api/v1/users` - Create a new user (register)

    email VARCHAR(255) UNIQUE NOT NULL,- `PUT /api/v1/users/:id` - Update a user

    password_hash TEXT NOT NULL,- `DELETE /api/v1/users/:id` - Delete a user

    full_name VARCHAR(255),- `GET /api/v1/users/:id/snippets` - Get all snippets for a specific user

    avatar_url TEXT,

    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,### Snippets

    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP

);- `GET /api/v1/snippets` - Get all snippets (supports filtering by language, tag, search)

- `GET /api/v1/snippets/:id` - Get a specific snippet

-- Snippets- `POST /api/v1/snippets` - Create a new snippet

CREATE TABLE snippets (- `PUT /api/v1/snippets/:id` - Update a snippet

    id SERIAL PRIMARY KEY,- `DELETE /api/v1/snippets/:id` - Delete a snippet

    title VARCHAR(255) NOT NULL,

    description TEXT,## Request/Response Examples

    code TEXT NOT NULL,

    language VARCHAR(50),### Register a New User

    tags TEXT[],

    user_id UUID REFERENCES users(id) ON DELETE CASCADE,```bash

    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,curl -X POST http://localhost:8080/api/v1/users \

    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP  -H "Content-Type: application/json" \

);  -d '{

```    "username": "johndoe",

    "email": "john@example.com",

## Performance Features    "password": "securepassword123",

    "fullName": "John Doe",

- **Connection pooling**: 25 max, 5 idle connections    "avatarUrl": "https://example.com/avatar.jpg"

- **Indexes**: B-tree (created_at, language, username, email), GIN (tags, full-text search)  }'

- **Auto-updating timestamps**: Database triggers```

- **UUID generation**: PostgreSQL `uuid-ossp` extension

### Login

## Security

```bash

- Argon2id password hashing (64MB memory, 4 threads)curl -X POST http://localhost:8080/api/v1/auth/login \

- Constant-time password comparison  -H "Content-Type: application/json" \

- UUID prevents user enumeration  -d '{

- Password hashes excluded from API responses    "email": "john@example.com",

    "password": "securepassword123"

## Testing  }'

````

````bash

# Run testsResponse:

go test -v ./...

```json

# With coverage{

go test -v -cover ./...  "id": "550e8400-e29b-41d4-a716-446655440000",

```  "username": "johndoe",

  "email": "john@example.com",

Note: Integration tests require PostgreSQL running (`docker-compose up -d`)  "fullName": "John Doe",

  "avatarUrl": "https://example.com/avatar.jpg",

## Environment Variables  "createdAt": "2025-11-10T10:00:00Z",

  "updatedAt": "2025-11-10T10:00:00Z"

```bash}

DATABASE_URL=postgres://postgres:postgres@localhost:5432/snippy?sslmode=disable```

PORT=8080

```### Update User Password



## Project Structure```bash

curl -X PUT http://localhost:8080/api/v1/users/550e8400-e29b-41d4-a716-446655440000 \

```  -H "Content-Type: application/json" \

.  -d '{

‚îú‚îÄ‚îÄ main.go           # Server setup and routing    "password": "newsecurepassword456"

‚îú‚îÄ‚îÄ database.go       # Schema initialization  }'

‚îú‚îÄ‚îÄ models.go         # Data structures```

‚îú‚îÄ‚îÄ handlers.go       # Snippet endpoints

‚îú‚îÄ‚îÄ user_handlers.go  # User/auth endpoints### Get User by Username

‚îú‚îÄ‚îÄ auth.go           # Password hashing

‚îî‚îÄ‚îÄ *_test.go         # Test files```bash

```curl http://localhost:8080/api/v1/users/username/johndoe

````

## License

### Create a Snippet

```bash
curl -X POST http://localhost:8080/api/v1/snippets \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Git Status Shortcut",
    "description": "Quick command to check git status",
    "category": "git",
    "shortcut": "gst",
    "content": "git status -sb",
    "tags": ["git", "shortcuts"],
    "userId": "550e8400-e29b-41d4-a716-446655440000"
  }'
```

### Get All Snippets

```bash
curl http://localhost:8080/api/v1/snippets
```

### Get Snippets with Filters

```bash
# Filter by category
curl http://localhost:8080/api/v1/snippets?category=git

# Filter by tag
curl http://localhost:8080/api/v1/snippets?tag=shortcuts

# Search in title/description
curl http://localhost:8080/api/v1/snippets?search=status

# Limit results
curl http://localhost:8080/api/v1/snippets?limit=10
```

### Update a Snippet

```bash
curl -X PUT http://localhost:8080/api/v1/snippets/{id} \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Updated Git Status",
    "content": "git status -sb --show-stash"
  }'
```

### Delete a Snippet

```bash
curl -X DELETE http://localhost:8080/api/v1/snippets/{id}
```

## Project Structure

```
.
‚îú‚îÄ‚îÄ main.go             # Application entry point, PostgreSQL connection, and router setup
‚îú‚îÄ‚îÄ database.go         # Database schema initialization and helper functions
‚îú‚îÄ‚îÄ models.go           # Data models and request/response structures
‚îú‚îÄ‚îÄ handlers.go         # HTTP handlers for snippet endpoints
‚îú‚îÄ‚îÄ user_handlers.go    # HTTP handlers for user and authentication endpoints
‚îú‚îÄ‚îÄ auth.go             # Password hashing (Argon2id) and authentication utilities
‚îú‚îÄ‚îÄ docker-compose.yml  # PostgreSQL container setup
‚îú‚îÄ‚îÄ .env.example        # Example environment variables
‚îú‚îÄ‚îÄ go.mod              # Go module dependencies
‚îî‚îÄ‚îÄ README.md           # This file
```

## Database Schema

```sql
-- Users table with UUID primary key
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    username VARCHAR(255) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    full_name VARCHAR(255),
    avatar_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Snippets table with UUID foreign key to users
CREATE TABLE snippets (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    code TEXT NOT NULL,
    language VARCHAR(50),
    tags TEXT[],
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

## Security

- **UUID User IDs**: UUIDs are automatically generated by PostgreSQL using `uuid_generate_v4()`, providing:
  - Non-sequential IDs that don't expose user count
  - Globally unique identifiers
  - Better security against ID enumeration attacks
- **Argon2id Password Hashing**:
  - Time: 1 iteration
  - Memory: 64 MB
  - Threads: 4
  - Key length: 32 bytes
- Password hashes are never exposed in API responses
- Constant-time comparison is used for password verification to prevent timing attacks

## Environment Variables

- `DATABASE_URL` - PostgreSQL connection string (default: `postgres://postgres:postgres@localhost:5432/snippy?sslmode=disable`)
- `PORT` - Server port (default: `8080`)

## Development

### Quick Commands with Make

The project includes a Makefile with helpful commands:

```bash
# Format code
make format

# Check if code is formatted
make format-check

# Run linter
make lint

# Run security scans
make security

# Run tests
make test

# Run tests with coverage
make test-coverage

# Build application
make build

# Run all checks (format, lint, security, test, build)
make all

# Clean build artifacts
make clean

# Show all available commands
make help
```

### Testing

Run the test suite:

```bash
# Run all tests
go test -v ./...

# Run tests with coverage
go test -v -cover ./...

# Run tests with coverage report (or use: make test-coverage)
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```

**Note:** Integration tests require PostgreSQL to be running. Tests will automatically skip if the database is not available. To run full integration tests, make sure PostgreSQL is running via `docker-compose up -d`.

### CI/CD

The project uses GitHub Actions for continuous integration:

- **Tests**: Runs on every push and pull request with PostgreSQL service container
- **Security Scanning**:
  - `gosec` - Scans for security vulnerabilities in Go code
  - `govulncheck` - Checks for known vulnerabilities in dependencies
- **Code Quality**:
  - `gofmt` - Ensures consistent code formatting
  - `golangci-lint` - Comprehensive linting with 20+ linters enabled
- **Build**: Creates artifacts for successful builds

View the workflow configuration in `.github/workflows/ci.yml`.

## Stopping the Database

```bash
# Stop PostgreSQL container
docker-compose down

# Stop and remove all data
docker-compose down -v
```

## Deployment

### Automated Deployment

This project uses automated deployment to DigitalOcean via GitHub Actions with Docker Compose and systemd:

- **[üöÄ Deployment Guide](./docs/GITHUB_ACTIONS_DEPLOYMENT.md)** - Complete setup guide

**Quick setup**:

1. **GitHub Secrets** (one-time):
   - `DROPLET_HOST` - Your droplet IP
   - `DROPLET_USERNAME` - SSH user (typically `root`)
   - `DROPLET_SSH_KEY` - Private SSH key for GitHub Actions

2. **Deploy automatically** on every push to `main`:
   ```bash
   git push origin main
   # GitHub Actions builds binary and deploys via systemd
   ```

3. **Manual deploy** via GitHub UI:
   - Go to **Actions** ‚Üí **Deploy to DigitalOcean** ‚Üí **Run workflow**

üìñ Full setup instructions: **[GitHub Actions Deployment Guide](./docs/GITHUB_ACTIONS_DEPLOYMENT.md)**

## Documentation

Comprehensive documentation is available in the `/docs` directory:

- **[üìö Documentation Index](./docs/README.md)** - Complete documentation overview
- **[üìñ API Reference](./docs/API.md)** - Detailed API endpoints with examples
- **[üîê Authentication Guide](./docs/AUTHENTICATION.md)** - JWT authentication & authorization
- **[ÔøΩÔ∏è Security Documentation](./docs/SECURITY.md)** - Security audit & best practices
- **[ÔøΩüíª Development Guide](./docs/DEVELOPMENT.md)** - Setup, testing, and workflows
- **[üèóÔ∏è Architecture](./docs/ARCHITECTURE.md)** - System design and components
- **[üóÑÔ∏è Database](./docs/DATABASE.md)** - Schema, indexes, and optimizations

### Quick Links

- [Authentication & Authorization](./docs/AUTHENTICATION.md) - How to use JWT tokens
- [Security Best Practices](./docs/SECURITY.md) - **NEW!** Production security checklist
- [How to add a new endpoint](./docs/DEVELOPMENT.md#adding-a-new-endpoint)
- [How to run tests](./docs/DEVELOPMENT.md#testing)
- [Database schema details](./docs/DATABASE.md#schema)
- [API error responses](./docs/API.md#error-responses)
- [Performance optimization guide](./docs/DATABASE.md#performance-optimizations)