#!/bin/bash
#
# Pre-commit hook to run code quality checks
# Install this hook by running: ln -s ../../.githooks/pre-commit .git/hooks/pre-commit
#

set -e

echo "Running pre-commit checks..."

# Check if code is formatted
echo "1. Checking code format..."
if [ "$(gofmt -s -l . | wc -l)" -gt 0 ]; then
  echo "❌ Code is not formatted. Run 'make format' to fix."
  gofmt -s -l .
  exit 1
fi
echo "✅ Code format check passed"

# Run linter (fast checks only)
echo "2. Running linter..."
if command -v golangci-lint &> /dev/null; then
  golangci-lint run --fast --timeout=2m
  echo "✅ Linter checks passed"
else
  echo "⚠️  golangci-lint not found. Install it with: make lint"
fi

# Run tests
echo "3. Running tests..."
if go test -short ./... > /dev/null 2>&1; then
  echo "✅ Tests passed"
else
  echo "❌ Tests failed. Please fix before committing."
  exit 1
fi

echo ""
echo "✅ All pre-commit checks passed!"
